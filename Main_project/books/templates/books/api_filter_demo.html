{% extends 'base.html' %}

{% block title %}–î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ API{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <h1 class="mb-4">üîç –î–µ–º–æ–Ω—Å—Ç—Ä–∞—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤ API</h1>
            
            <div class="alert alert-info">
                <h5>‚ÑπÔ∏è –ö–∞–∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã –≤ API</h5>
                <p>–§–∏–ª—å—Ç—Ä—ã —Ä–∞–±–æ—Ç–∞—é—Ç —á–µ—Ä–µ–∑ URL –ø–∞—Ä–∞–º–µ—Ç—Ä—ã. –í—ã –º–æ–∂–µ—Ç–µ –∫–æ–º–±–∏–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ—Å–∫–æ–ª—å–∫–æ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ –æ–¥–Ω–æ–º –∑–∞–ø—Ä–æ—Å–µ.</p>
            </div>

            <!-- –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
            <div class="row mb-4">
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>üìö –î–æ—Å—Ç—É–ø–Ω—ã–µ –∞–≤—Ç–æ—Ä—ã</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                {% for author in authors %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ author.name }}
                                    <span class="badge bg-primary rounded-pill">ID: {{ author.id }}</span>
                                </li>
                                {% empty %}
                                <li class="list-group-item text-muted">–ê–≤—Ç–æ—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
                
                <div class="col-md-6">
                    <div class="card">
                        <div class="card-header">
                            <h5>üé≠ –î–æ—Å—Ç—É–ø–Ω—ã–µ –∂–∞–Ω—Ä—ã</h5>
                        </div>
                        <div class="card-body">
                            <ul class="list-group list-group-flush">
                                {% for genre in genres %}
                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                    {{ genre.name }}
                                    <span class="badge bg-success rounded-pill">ID: {{ genre.id }}</span>
                                </li>
                                {% empty %}
                                <li class="list-group-item text-muted">–ñ–∞–Ω—Ä—ã –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</li>
                                {% endfor %}
                            </ul>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –ü—Ä–∏–º–µ—Ä—ã —Ñ–∏–ª—å—Ç—Ä–æ–≤ -->
            <div class="card">
                <div class="card-header">
                    <h5>üí° –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ñ–∏–ª—å—Ç—Ä–æ–≤</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped">
                            <thead>
                                <tr>
                                    <th>–ù–∞–∑–≤–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞</th>
                                    <th>URL</th>
                                    <th>–û–ø–∏—Å–∞–Ω–∏–µ</th>
                                    <th>–î–µ–π—Å—Ç–≤–∏–µ</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for example in filter_examples %}
                                <tr>
                                    <td><strong>{{ example.name }}</strong></td>
                                    <td>
                                        <code class="text-primary">{{ example.url }}</code>
                                    </td>
                                    <td>{{ example.description }}</td>
                                    <td>
                                        <a href="{{ example.url }}" class="btn btn-sm btn-outline-primary" target="_blank">
                                            üîó –û—Ç–∫—Ä—ã—Ç—å
                                        </a>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–µ—Ä -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>üß™ –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ç–µ—Å—Ç–µ—Ä —Ñ–∏–ª—å—Ç—Ä–æ–≤</h5>
                </div>
                <div class="card-body">
                    <form id="filterForm" class="row g-3">
                        <div class="col-md-6">
                            <label for="title" class="form-label">–ù–∞–∑–≤–∞–Ω–∏–µ –∫–Ω–∏–≥–∏</label>
                            <input type="text" class="form-control" id="title" name="title" placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="author" class="form-label">–ê–≤—Ç–æ—Ä</label>
                            <select class="form-select" id="author" name="author">
                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∞–≤—Ç–æ—Ä–∞</option>
                                {% for author in authors %}
                                <option value="{{ author.id }}">{{ author.name }}</option>
                                {% endfor %}
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="min_price" class="form-label">–ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</label>
                            <input type="number" class="form-control" id="min_price" name="min_price" placeholder="0">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="max_price" class="form-label">–ú–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</label>
                            <input type="number" class="form-control" id="max_price" name="max_price" placeholder="1000">
                        </div>
                        
                        <div class="col-md-6">
                            <label for="status" class="form-label">–°—Ç–∞—Ç—É—Å</label>
                            <select class="form-select" id="status" name="status">
                                <option value="">–õ—é–±–æ–π —Å—Ç–∞—Ç—É—Å</option>
                                <option value="available">–í –Ω–∞–ª–∏—á–∏–∏</option>
                                <option value="out_of_stock">–ù–µ—Ç –≤ –Ω–∞–ª–∏—á–∏–∏</option>
                                <option value="pre_order">–ü—Ä–µ–¥–∑–∞–∫–∞–∑</option>
                            </select>
                        </div>
                        
                        <div class="col-md-6">
                            <label for="has_discount" class="form-label">–°–∫–∏–¥–∫–∞</label>
                            <select class="form-select" id="has_discount" name="has_discount">
                                <option value="">–õ—é–±—ã–µ –∫–Ω–∏–≥–∏</option>
                                <option value="true">–¢–æ–ª—å–∫–æ —Å–æ —Å–∫–∏–¥–∫–æ–π</option>
                                <option value="false">–ë–µ–∑ —Å–∫–∏–¥–∫–∏</option>
                            </select>
                        </div>
                        
                        <div class="col-12">
                            <button type="submit" class="btn btn-primary">üîç –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Ñ–∏–ª—å—Ç—Ä—ã</button>
                            <button type="button" class="btn btn-secondary" onclick="clearFilters()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
                        </div>
                    </form>
                    
                    <div class="mt-3">
                        <strong>–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π URL:</strong>
                        <div class="alert alert-light">
                            <code id="generatedUrl">/api/books/</code>
                        </div>
                    </div>
                </div>
            </div>

            <!-- –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è -->
            <div class="card mt-4">
                <div class="card-header">
                    <h5>üìñ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Ñ–∏–ª—å—Ç—Ä–∞–º</h5>
                </div>
                <div class="card-body">
                    <h6>–î–æ—Å—Ç—É–ø–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã –¥–ª—è –∫–Ω–∏–≥:</h6>
                    <ul>
                        <li><code>title</code> - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é (—Å–æ–¥–µ—Ä–∂–∏—Ç)</li>
                        <li><code>author</code> - ID –∞–≤—Ç–æ—Ä–∞</li>
                        <li><code>genres</code> - ID –∂–∞–Ω—Ä–æ–≤ —á–µ—Ä–µ–∑ –∑–∞–ø—è—Ç—É—é (1,2,3)</li>
                        <li><code>min_price</code> - –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</li>
                        <li><code>max_price</code> - –º–∞–∫—Å–∏–º–∞–ª—å–Ω–∞—è —Ü–µ–Ω–∞</li>
                        <li><code>status</code> - —Å—Ç–∞—Ç—É—Å (available, out_of_stock, pre_order)</li>
                        <li><code>has_discount</code> - –Ω–∞–ª–∏—á–∏–µ —Å–∫–∏–¥–∫–∏ (true/false)</li>
                        <li><code>created_after</code> - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –ø–æ—Å–ª–µ (YYYY-MM-DD HH:MM:SS)</li>
                        <li><code>created_before</code> - –¥–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–æ (YYYY-MM-DD HH:MM:SS)</li>
                        <li><code>price_range</code> - –¥–∏–∞–ø–∞–∑–æ–Ω —Ü–µ–Ω (100,500)</li>
                        <li><code>rating_min</code> - –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π —Ä–µ–π—Ç–∏–Ω–≥</li>
                        <li><code>in_stock</code> - —Ç–æ–ª—å–∫–æ –≤ –Ω–∞–ª–∏—á–∏–∏ (true/false)</li>
                    </ul>
                    
                    <h6>–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:</h6>
                    <ul>
                        <li><code>search</code> - –ø–æ–∏—Å–∫ –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é, –∞–≤—Ç–æ—Ä—É, –æ–ø–∏—Å–∞–Ω–∏—é</li>
                        <li><code>ordering</code> - —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞ (price, -price, created_at, title)</li>
                        <li><code>page</code> - –Ω–æ–º–µ—Ä —Å—Ç—Ä–∞–Ω–∏—Ü—ã</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function updateUrl() {
    const form = document.getElementById('filterForm');
    const formData = new FormData(form);
    const params = new URLSearchParams();
    
    for (let [key, value] of formData.entries()) {
        if (value) {
            params.append(key, value);
        }
    }
    
    const url = '/api/books/' + (params.toString() ? '?' + params.toString() : '');
    document.getElementById('generatedUrl').textContent = url;
}

function clearFilters() {
    document.getElementById('filterForm').reset();
    updateUrl();
}

// –û–±–Ω–æ–≤–ª—è–µ–º URL –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –ø–æ–ª–µ–π —Ñ–æ—Ä–º—ã
document.getElementById('filterForm').addEventListener('change', updateUrl);
document.getElementById('filterForm').addEventListener('input', updateUrl);

// –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ñ–æ—Ä–º—ã
document.getElementById('filterForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const url = document.getElementById('generatedUrl').textContent;
    window.open(url, '_blank');
});

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
updateUrl();
</script>
{% endblock %} 